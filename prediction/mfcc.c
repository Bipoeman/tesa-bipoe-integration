/*
 * Academic License - for use in teaching, academic research, and meeting
 * course requirements at degree granting institutions only.  Not for
 * government, commercial, or other organizational use.
 * File: mfcc.c
 *
 * MATLAB Coder version            : 24.2
 * C/C++ source code generated on  : 15-Nov-2024 02:25:16
 */

/* Include Files */
#include "mfcc.h"
#include "FFTImplementationCallback.h"
#include "NeuralNgin_emxutil.h"
#include "NeuralNgin_types.h"
#include "cepstralCoefficients.h"
#include "designMelFilterBank.h"
#include "../fft/rt_nonfinite.h"
#include "../fft/rt_nonfinite.h"
#include <math.h>
#include <string.h>

/* Function Definitions */
/*
 * Arguments    : const double audioIn[43200]
 *                double fs
 *                double varargout_1[14042]
 * Return Type  : void
 */
void mfcc(const double audioIn[43200], double fs, double varargout_1[14042])
{
  static creal_T b_y[86258];
  static const double b_dv[129] = {0.0,
                                   0.024541228522912288,
                                   0.049067674327418015,
                                   0.073564563599667426,
                                   0.0980171403295606,
                                   0.1224106751992162,
                                   0.14673047445536175,
                                   0.17096188876030122,
                                   0.19509032201612825,
                                   0.2191012401568698,
                                   0.24298017990326387,
                                   0.26671275747489837,
                                   0.29028467725446233,
                                   0.31368174039889152,
                                   0.33688985339222005,
                                   0.35989503653498811,
                                   0.38268343236508978,
                                   0.40524131400498986,
                                   0.42755509343028208,
                                   0.44961132965460654,
                                   0.47139673682599764,
                                   0.49289819222978404,
                                   0.51410274419322166,
                                   0.53499761988709715,
                                   0.55557023301960218,
                                   0.57580819141784534,
                                   0.59569930449243336,
                                   0.61523159058062682,
                                   0.63439328416364549,
                                   0.65317284295377676,
                                   0.67155895484701833,
                                   0.68954054473706683,
                                   0.70710678118654757,
                                   0.724247082951467,
                                   0.74095112535495922,
                                   0.75720884650648457,
                                   0.773010453362737,
                                   0.78834642762660634,
                                   0.80320753148064494,
                                   0.81758481315158371,
                                   0.83146961230254524,
                                   0.84485356524970712,
                                   0.85772861000027212,
                                   0.87008699110871146,
                                   0.881921264348355,
                                   0.89322430119551532,
                                   0.90398929312344334,
                                   0.91420975570353069,
                                   0.92387953251128674,
                                   0.932992798834739,
                                   0.94154406518302081,
                                   0.94952818059303667,
                                   0.95694033573220882,
                                   0.96377606579543984,
                                   0.970031253194544,
                                   0.97570213003852857,
                                   0.98078528040323043,
                                   0.98527764238894122,
                                   0.989176509964781,
                                   0.99247953459871,
                                   0.99518472667219693,
                                   0.99729045667869021,
                                   0.99879545620517241,
                                   0.99969881869620425,
                                   1.0,
                                   0.99969881869620425,
                                   0.99879545620517241,
                                   0.99729045667869021,
                                   0.99518472667219693,
                                   0.99247953459871,
                                   0.989176509964781,
                                   0.98527764238894122,
                                   0.98078528040323043,
                                   0.97570213003852857,
                                   0.970031253194544,
                                   0.96377606579543984,
                                   0.95694033573220882,
                                   0.94952818059303667,
                                   0.94154406518302081,
                                   0.932992798834739,
                                   0.92387953251128674,
                                   0.91420975570353069,
                                   0.90398929312344334,
                                   0.89322430119551532,
                                   0.881921264348355,
                                   0.87008699110871146,
                                   0.85772861000027212,
                                   0.84485356524970712,
                                   0.83146961230254524,
                                   0.81758481315158371,
                                   0.80320753148064494,
                                   0.78834642762660634,
                                   0.773010453362737,
                                   0.75720884650648457,
                                   0.74095112535495922,
                                   0.724247082951467,
                                   0.70710678118654757,
                                   0.68954054473706683,
                                   0.67155895484701833,
                                   0.65317284295377676,
                                   0.63439328416364549,
                                   0.61523159058062682,
                                   0.59569930449243336,
                                   0.57580819141784534,
                                   0.55557023301960218,
                                   0.53499761988709715,
                                   0.51410274419322166,
                                   0.49289819222978404,
                                   0.47139673682599764,
                                   0.44961132965460654,
                                   0.42755509343028208,
                                   0.40524131400498986,
                                   0.38268343236508978,
                                   0.35989503653498811,
                                   0.33688985339222005,
                                   0.31368174039889152,
                                   0.29028467725446233,
                                   0.26671275747489837,
                                   0.24298017990326387,
                                   0.2191012401568698,
                                   0.19509032201612825,
                                   0.17096188876030122,
                                   0.14673047445536175,
                                   0.1224106751992162,
                                   0.0980171403295606,
                                   0.073564563599667426,
                                   0.049067674327418015,
                                   0.024541228522912288,
                                   0.0};
  static const double dv1[86] = {0.080000000000000016, 0.081227149514766284,
                                 0.084902050685449315, 0.0910050963242735,
                                 0.099503724042133257, 0.11035258998302794,
                                 0.12349381075315258,  0.13885727225384853,
                                 0.15636100377065615,  0.17591161532254312,
                                 0.19740479593786037,  0.22072587019850848,
                                 0.24575041008291004,  0.27234489884334162,
                                 0.3003674433755521,   0.32966853127986628,
                                 0.36009182857452826,  0.39147501380513472,
                                 0.42365064409982689,  0.45644704854945928,
                                 0.48968924414617776,  0.52319986939347685,
                                 0.55680013060652311,  0.5903107558538222,
                                 0.62355295145054079,  0.65634935590017318,
                                 0.68852498619486524,  0.71990817142547181,
                                 0.75033146872013379,  0.779632556624448,
                                 0.80765510115665828,  0.83424958991708986,
                                 0.85927412980149165,  0.88259520406213965,
                                 0.90408838467745689,  0.92363899622934387,
                                 0.9411427277461516,   0.95650618924684749,
                                 0.96964741001697208,  0.98049627595786681,
                                 0.98899490367572651,  0.99509794931455076,
                                 0.99877285048523379,  1.0,
                                 0.99877285048523379,  0.99509794931455076,
                                 0.98899490367572651,  0.98049627595786681,
                                 0.96964741001697208,  0.95650618924684749,
                                 0.9411427277461516,   0.92363899622934387,
                                 0.90408838467745689,  0.88259520406213965,
                                 0.85927412980149165,  0.83424958991708986,
                                 0.80765510115665828,  0.779632556624448,
                                 0.75033146872013379,  0.71990817142547181,
                                 0.68852498619486524,  0.65634935590017318,
                                 0.62355295145054079,  0.5903107558538222,
                                 0.55680013060652311,  0.52319986939347685,
                                 0.48968924414617776,  0.45644704854945928,
                                 0.42365064409982689,  0.39147501380513472,
                                 0.36009182857452826,  0.32966853127986628,
                                 0.3003674433755521,   0.27234489884334162,
                                 0.24575041008291004,  0.22072587019850848,
                                 0.19740479593786037,  0.17591161532254312,
                                 0.15636100377065615,  0.13885727225384853,
                                 0.12349381075315258,  0.11035258998302794,
                                 0.099503724042133257, 0.0910050963242735,
                                 0.084902050685449315, 0.081227149514766284};
  static const double dv2[42] = {133.33333333333334,
                                 200.0,
                                 266.66666666666669,
                                 333.33333333333337,
                                 400.0,
                                 466.66666666666674,
                                 533.33333333333337,
                                 600.0,
                                 666.66666666666674,
                                 733.33333333333337,
                                 800.00000000000011,
                                 866.66666666666674,
                                 933.33333333333337,
                                 999.75894666666659,
                                 1070.9120908286172,
                                 1147.1292256065171,
                                 1228.7707567317004,
                                 1316.2227401195225,
                                 1409.8987074006509,
                                 1510.2416213759673,
                                 1617.725970641781,
                                 1732.8600132901477,
                                 1856.1881802940113,
                                 1988.29364994199,
                                 2129.8011054964563,
                                 2281.3796891149705,
                                 2443.7461660031895,
                                 2617.6683137614859,
                                 2803.9685529523849,
                                 3003.5278360565717,
                                 3217.2898132070686,
                                 3446.2652943999592,
                                 3691.5370292819921,
                                 3954.2648271171,
                                 4235.6910411424715,
                                 4537.1464432478933,
                                 4860.0565167577788,
                                 5205.9481970723846,
                                 5576.4570920424849,
                                 5973.3352162202755,
                                 6398.4592755592366,
                                 6853.83954173857};
  static const double options_BandEdges[42] = {133.33333333333334,
                                               200.0,
                                               266.66666666666669,
                                               333.33333333333337,
                                               400.0,
                                               466.66666666666674,
                                               533.33333333333337,
                                               600.0,
                                               666.66666666666674,
                                               733.33333333333337,
                                               800.00000000000011,
                                               866.66666666666674,
                                               933.33333333333337,
                                               999.75894666666659,
                                               1070.9120908286172,
                                               1147.1292256065171,
                                               1228.7707567317004,
                                               1316.2227401195225,
                                               1409.8987074006509,
                                               1510.2416213759673,
                                               1617.725970641781,
                                               1732.8600132901477,
                                               1856.1881802940113,
                                               1988.29364994199,
                                               2129.8011054964563,
                                               2281.3796891149705,
                                               2443.7461660031895,
                                               2617.6683137614859,
                                               2803.9685529523849,
                                               3003.5278360565717,
                                               3217.2898132070686,
                                               3446.2652943999592,
                                               3691.5370292819921,
                                               3954.2648271171,
                                               4235.6910411424715,
                                               4537.1464432478933,
                                               4860.0565167577788,
                                               5205.9481970723846,
                                               5576.4570920424849,
                                               5973.3352162202755,
                                               6398.4592755592366,
                                               6853.83954173857};
  static double Z[86258];
  static double y[86258];
  static double coeffs[13039];
  emxArray_real_T *c_y;
  double filterBank_data[3440];
  double E[1003];
  double edges_data[42];
  double bkj;
  double *y_data;
  int edges_size[2];
  int filterBank_size[2];
  int b_i;
  int coffset;
  int i;
  int j;
  int k;
  int xpageoffset;
  bool x[42];
  for (xpageoffset = 0; xpageoffset < 1003; xpageoffset++) {
    memcpy(&y[xpageoffset * 86], &audioIn[xpageoffset * 43],
           86U * sizeof(double));
  }
  for (k = 0; k < 86258; k++) {
    bkj = y[k];
    Z[k] = bkj * bkj;
  }
  for (coffset = 0; coffset < 1003; coffset++) {
    xpageoffset = coffset * 86;
    bkj = Z[xpageoffset];
    for (k = 0; k < 85; k++) {
      bkj += Z[(xpageoffset + k) + 1];
    }
    E[coffset] = bkj;
    if (bkj == 0.0) {
      E[coffset] = 2.2250738585072014E-308;
    }
  }
  for (k = 0; k < 1003; k++) {
    E[k] = log(E[k]);
    for (coffset = 0; coffset < 86; coffset++) {
      xpageoffset = coffset + 86 * k;
      Z[xpageoffset] = y[xpageoffset] * dv1[coffset];
    }
  }
  c_FFTImplementationCallback_dob(Z, b_dv, b_y);
  for (k = 0; k < 86258; k++) {
    double b;
    bkj = fabs(b_y[k].re);
    b = fabs(b_y[k].im);
    if (bkj < b) {
      bkj /= b;
      Z[k] = b * sqrt(bkj * bkj + 1.0);
    } else if (bkj > b) {
      b /= bkj;
      Z[k] = bkj * sqrt(b * b + 1.0);
    } else if (rtIsNaN(b)) {
      Z[k] = rtNaN;
    } else {
      Z[k] = bkj * 1.4142135623730951;
    }
  }
  bkj = fs / 2.0;
  for (i = 0; i < 42; i++) {
    x[i] = (bkj >= options_BandEdges[i]);
  }
  xpageoffset = x[0];
  for (k = 0; k < 41; k++) {
    xpageoffset += x[k + 1];
  }
  if (xpageoffset < 42) {
    edges_size[0] = 1;
    edges_size[1] = xpageoffset + 1;
    memcpy(&edges_data[0], &dv2[0],
           (unsigned int)(xpageoffset + 1) * sizeof(double));
    edges_data[xpageoffset] = fs / 2.0;
  } else {
    edges_size[0] = 1;
    edges_size[1] = 42;
    memcpy(&edges_data[0], &options_BandEdges[0], 42U * sizeof(double));
  }
  designMelFilterBank(fs, edges_data, edges_size, filterBank_data,
                      filterBank_size);
  xpageoffset = filterBank_size[1];
  emxInit_real_T(&c_y, 2);
  i = c_y->size[0] * c_y->size[1];
  c_y->size[0] = filterBank_size[1];
  c_y->size[1] = 1003;
  emxEnsureCapacity_real_T(c_y, i);
  y_data = c_y->data;
  for (j = 0; j < 1003; j++) {
    int boffset;
    coffset = j * xpageoffset;
    boffset = j * 86;
    for (b_i = 0; b_i < xpageoffset; b_i++) {
      y_data[coffset + b_i] = 0.0;
    }
    for (k = 0; k < 86; k++) {
      bkj = Z[boffset + k];
      for (b_i = 0; b_i < xpageoffset; b_i++) {
        i = coffset + b_i;
        y_data[i] += filterBank_data[b_i * 86 + k] * bkj;
      }
    }
  }
  cepstralCoefficients(c_y, coeffs);
  emxFree_real_T(&c_y);
  memcpy(&varargout_1[0], &E[0], 1003U * sizeof(double));
  memcpy(&varargout_1[1003], &coeffs[0], 13039U * sizeof(double));
}

/*
 * File trailer for mfcc.c
 *
 * [EOF]
 */
